(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{3918:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/beat/[id]",function(){return l(2347)}])},2347:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return g}});var s=l(5893),a=l(1163),r=l(7294);let n=(0,l(8967).eI)("https://ssaxfvlcpjygsdyymlvy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzYXhmdmxjcGp5Z3NkeXltbHZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1NTgwMTgsImV4cCI6MjA2MzEzNDAxOH0.lpq3C8QCZT3aW3kDb5SgYmr0fS3cvXAyaQDIqsmMDFE");var i=l(1787),c=l(6179),o=l(9482),d=l(9769),u=l(5999),x=l(1352);let p=e=>{let{isOpen:t,onClose:l,beat:a,onUpdate:i}=e,[c,o]=(0,r.useState)(a.name),[d,u]=(0,r.useState)(a.key),[p,m]=(0,r.useState)(a.bpm.toString()),[h,b]=(0,r.useState)(a.price.toString()),[g,f]=(0,r.useState)(!1),j=async e=>{e.preventDefault(),f(!0);let{error:t}=await n.from("beats").update({name:c,key:d,bpm:parseInt(p),price:parseFloat(h)}).eq("id",a.id);f(!1),t?alert("Failed to update beat: "+t.message):(alert("Beat updated!"),i(),l())};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative",children:[(0,s.jsx)("button",{className:"absolute top-3 right-3 text-gray-500 hover:text-black",onClick:l,children:(0,s.jsx)(x.Z,{})}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-center",children:"Edit Beat"}),(0,s.jsxs)("form",{className:"space-y-3",onSubmit:j,children:[(0,s.jsx)("input",{type:"text",placeholder:"Beat Name",className:"w-full border rounded p-2",value:c,onChange:e=>o(e.target.value)}),(0,s.jsx)("input",{type:"text",placeholder:"Key",className:"w-full border rounded p-2",value:d,onChange:e=>u(e.target.value)}),(0,s.jsx)("input",{type:"text",placeholder:"BPM",className:"w-full border rounded p-2",value:p,onChange:e=>m(e.target.value)}),(0,s.jsx)("input",{type:"text",placeholder:"Price",className:"w-full border rounded p-2",value:h,onChange:e=>b(e.target.value)}),(0,s.jsx)("button",{type:"submit",disabled:g,className:"w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:g?"Updating...":"Update Beat"})]})]})}):null},m=null,h=null;var b=e=>{let{beat:t,onDelete:l,showCopyLink:a=!0}=e,b=(0,r.useRef)(null),[g,f]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),[v,k]=(0,r.useState)(!1),[C,S]=(0,r.useState)(null),[I,z]=(0,r.useState)(!1),E=async()=>{if(!window.confirm("Are you sure you want to delete this beat?"))return;let{error:e}=await n.from("beats").delete().eq("id",t.id);e?alert("Failed to delete beat: "+e.message):(alert("Beat deleted!"),l&&l())},_=async()=>{try{let e="".concat(window.location.origin,"/beat/").concat(t.id);await navigator.clipboard.writeText(e),z(!0),setTimeout(()=>z(!1),2e3)}catch(e){console.error("Failed to copy link:",e)}},Z=localStorage.getItem("userPhone"),D=t.phone===Z;return(0,s.jsxs)("div",{className:"flex flex-wrap items-center bg-white rounded-2xl shadow-sm hover:shadow-md transition-all px-5 py-5 gap-4 w-full border border-blue-100",children:[(0,s.jsx)("img",{src:t.coverArt,alt:t.name,className:"w-20 h-20 rounded-lg object-cover"}),(0,s.jsxs)("div",{className:"flex-1 min-w-[150px]",children:[(0,s.jsx)("h3",{title:t.name,className:"font-semibold text-blue-900 text-base sm:text-lg leading-snug break-words line-clamp-2",children:t.name}),(0,s.jsx)("p",{className:"text-sm text-gray-600 truncate",children:t.uploader}),(0,s.jsxs)("p",{className:"text-sm text-blue-700 tracking-wide",children:[t.key," â€¢ ",t.bpm," BPM"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-end",children:[a&&(0,s.jsx)("button",{onClick:_,title:I?"Link copied!":"Copy link",className:"p-2 rounded-full transition-colors ".concat(I?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:(0,s.jsx)(i.Z,{size:16})}),(0,s.jsxs)("button",{onClick:()=>{b.current&&(b.current.paused?(m&&m!==b.current&&(m.pause(),h&&h(!1)),b.current.play(),f(!0),m=b.current,h=f):(b.current.pause(),f(!1),m===b.current&&(m=null,h=null)))},className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-full text-sm flex items-center space-x-1",children:[g?(0,s.jsx)(c.Z,{size:16}):(0,s.jsx)(o.Z,{size:16}),(0,s.jsx)("span",{children:g?"Pause":"Play"})]}),(0,s.jsxs)("button",{onClick:()=>k(!0),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-full text-sm flex items-center space-x-1",children:[(0,s.jsx)(d.Z,{size:16}),(0,s.jsx)("span",{children:"Buy"})]}),l&&(0,s.jsx)("button",{onClick:l,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-full text-sm",children:"Delete"}),(0,s.jsxs)("span",{className:"bg-red-600 text-white text-xs px-3 py-1 rounded-full shadow font-semibold whitespace-nowrap",children:["NPR ",t.price]}),D&&(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{onClick:()=>w(!j),className:"text-blue-500 hover:text-blue-700",children:(0,s.jsx)(u.Z,{size:18})}),j&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 bg-white shadow-md rounded z-10 w-28",children:[(0,s.jsx)("button",{className:"block w-full text-left px-3 py-2 hover:bg-blue-100 text-sm",onClick:()=>{S(t),N(!0),w(!1)},children:"Edit"}),(0,s.jsx)("button",{className:"block w-full text-left px-3 py-2 hover:bg-red-100 text-sm text-red-600",onClick:()=>{w(!1),E()},children:"Delete"})]})]})]}),(0,s.jsx)("audio",{ref:b,src:t.audioUrl,onEnded:()=>{f(!1),m===b.current&&(m=null,h=null)},hidden:!0}),v&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-green-600 text-white p-6 rounded-xl shadow-lg text-center relative w-72",children:[(0,s.jsx)("button",{className:"absolute top-2 right-2 text-white hover:text-gray-200",onClick:()=>k(!1),children:(0,s.jsx)(x.Z,{size:20})}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:"\uD83D\uDCDE Call the producer:"}),(0,s.jsx)("a",{href:"tel:".concat(t.producerPhone),className:"block mt-4 text-xl font-bold underline",children:t.producerPhone})]})}),y&&C&&(0,s.jsx)(p,{isOpen:y,onClose:()=>N(!1),beat:C,onUpdate:null!=l?l:()=>{}})]})};function g(){let{id:e}=(0,a.useRouter)().query,[t,l]=(0,r.useState)(null);return((0,r.useEffect)(()=>{e&&(async()=>{let{data:t,error:s}=await n.from("beats").select("*").eq("id",e).single();!s&&t?l(t):console.error("Error fetching beat:",s)})()},[e]),t)?(0,s.jsx)("div",{className:"min-h-screen bg-gray-100 py-10 px-4 flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-full max-w-xl",children:(0,s.jsx)(b,{beat:{id:t.id,name:t.name,key:t.key,bpm:t.bpm,price:t.price,phone:t.phone,uploader:t.uploader,coverArt:t.cover_url,audioUrl:t.audio_url,producerPhone:t.phone},showCopyLink:!0})})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center text-gray-600 text-sm",children:"Beat not found or loading..."})}}},function(e){e.O(0,[412,888,774,179],function(){return e(e.s=3918)}),_N_E=e.O()}]);