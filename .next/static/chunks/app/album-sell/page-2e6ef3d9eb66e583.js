(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[267],{3354:function(e,l,t){Promise.resolve().then(t.bind(t,9945))},9945:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return m}});var r=t(3827),s=t(4090),a=t(1654),n=t(9259),i=t(244);function o(e){let{album:l}=e,[t,a]=(0,s.useState)(!1),[o,u]=(0,s.useState)(!1),c=(0,s.useRef)([]);(0,s.useEffect)(()=>{c.current.forEach((e,l)=>{e&&(e.onplay=()=>{c.current.forEach((e,t)=>{l!==t&&e&&!e.paused&&e.pause()})})})},[]);let d=async()=>{try{await navigator.clipboard.writeText(window.location.href),u(!0),setTimeout(()=>u(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return"Test Album"===l.name&&"Test Artist"===l.artist_name?null:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-md hover:shadow-lg transition-all w-full max-w-sm mx-auto flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"relative aspect-square w-full",children:[(0,r.jsx)("img",{src:l.cover_url||"https://via.placeholder.com/300?text=No+Cover",alt:"Album Cover",className:"object-cover w-full h-full rounded-t-2xl"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/30 to-transparent rounded-t-2xl"})]}),(0,r.jsxs)("div",{className:"p-5 flex flex-col gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-blue-900 truncate",children:l.name||"Untitled Album"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 truncate",children:["By ",l.artist_name||"Unknown Artist"]}),(0,r.jsxs)("p",{className:"text-green-600 font-semibold mt-1",children:["NPR ",l.price]})]}),(0,r.jsx)("div",{className:"space-y-2",children:[l.preview_1_url,l.preview_2_url,l.preview_3_url].map((e,l)=>e&&(0,r.jsx)("audio",{ref:e=>{e&&(c.current[l]=e)},controls:!0,controlsList:"nodownload",className:"w-full rounded border",src:e},l))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>a(!0),className:"flex-1 py-2.5 px-4 bg-blue-600 text-white text-sm font-medium rounded-lg flex items-center justify-center gap-2 hover:bg-blue-700 transition-colors",children:"Buy Album"}),(0,r.jsx)("button",{onClick:d,className:"py-2.5 px-3 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg flex items-center justify-center gap-2 hover:bg-gray-200 transition","aria-label":"Copy link",children:o?(0,r.jsx)(n.Z,{size:16,className:"text-green-600"}):(0,r.jsx)(i.Z,{size:16})})]})]}),t&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-xl w-full max-w-sm text-center shadow-xl",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-4 text-blue-800",children:"Contact to Purchase"}),(0,r.jsx)("img",{src:l.qr_code_url,alt:"QR Code",className:"w-40 h-40 mx-auto rounded mb-4"}),(0,r.jsxs)("p",{className:"text-lg text-green-700 font-semibold",children:["\uD83D\uDCDE ",l.phone_number]}),(0,r.jsx)("button",{onClick:()=>a(!1),className:"mt-6 bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-full transition",children:"Close"})]})})]})}function u(){var e;let[l,t]=(0,s.useState)(null),[n,i]=(0,s.useState)({name:"",artist:"",price:"",phone:"",coverImage:null,preview1:null,preview2:null,preview3:null,qrCode:null}),[o,u]=(0,s.useState)(!1),[c,d]=(0,s.useState)("");(0,s.useEffect)(()=>{a.O.auth.getSession().then(e=>{let{data:l}=e;t(l.session),console.log("\uD83D\uDD10 SESSION:",l.session)})},[]);let m=e=>{let{name:l,value:t,files:r}=e.target;r?i(e=>({...e,[l]:r[0]})):i(e=>({...e,[l]:t}))},x=async(e,l)=>{let t=l.name.replace(/\s+/g,"_"),r="".concat(Date.now(),"-").concat(t),{data:s,error:n}=await a.O.storage.from(e).upload(r,l);if(n)throw console.error("❌ Upload error:",n.message),n;let{data:i}=a.O.storage.from(e).getPublicUrl(r);return i.publicUrl},p=async e=>{var t;if(e.preventDefault(),d(""),!(null==l?void 0:null===(t=l.user)||void 0===t?void 0:t.id)){alert("❌ You must be logged in.");return}console.log("\uD83D\uDCE4 Uploading as user:",l.user.id),u(!0);try{let e=await x("album-covers",n.coverImage),t=await x("album-previews",n.preview1),r=await x("album-previews",n.preview2),s=await x("album-previews",n.preview3),i=await x("album-qrcodes",n.qrCode),o={name:n.name,artist_name:n.artist,price:n.price,phone_number:n.phone,user_id:l.user.id,album_url:null,cover_url:e,preview_1_url:t,preview_2_url:r,preview_3_url:s,qr_code_url:i};console.log("⬆️ INSERTING album:",o);let{data:u,error:c}=await a.O.from("albums").insert(o).select("*");if(c){console.error("\uD83D\uDEAB INSERT ERROR:",c.message),d("Upload failed: "+c.message);return}alert("✅ Album uploaded successfully!")}catch(e){console.error("⚠️ Unexpected error:",e.message),d("Upload failed: "+e.message)}u(!1)};return(0,r.jsxs)("div",{children:[(null==l?void 0:null===(e=l.user)||void 0===e?void 0:e.id)?(0,r.jsxs)("div",{className:"p-3 mb-4 bg-green-100 text-green-800 rounded text-sm",children:["✅ Logged in as: ",(0,r.jsx)("b",{children:l.user.id})]}):(0,r.jsx)("div",{className:"p-3 mb-4 bg-red-100 text-red-800 rounded text-sm",children:"❌ Not logged in."}),c&&(0,r.jsx)("div",{className:"p-3 mb-4 bg-red-100 text-red-800 rounded text-sm",children:c}),(0,r.jsxs)("form",{onSubmit:p,className:"space-y-6 w-full max-w-2xl text-gray-800",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-center text-blue-900",children:"Upload New Album"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("input",{type:"text",name:"name",onChange:m,placeholder:"Album Name",className:"w-full p-3 border rounded",required:!0}),(0,r.jsx)("input",{type:"text",name:"artist",onChange:m,placeholder:"Artist Name",className:"w-full p-3 border rounded",required:!0}),(0,r.jsx)("input",{type:"number",name:"price",onChange:m,placeholder:"Price (NPR)",className:"w-full p-3 border rounded",required:!0}),(0,r.jsx)("input",{type:"text",name:"phone",onChange:m,placeholder:"Phone Number",className:"w-full p-3 border rounded",required:!0}),(0,r.jsx)("input",{type:"file",name:"coverImage",accept:"image/*",onChange:m,required:!0}),(0,r.jsx)("input",{type:"file",name:"preview1",accept:"audio/mp3",onChange:m,required:!0}),(0,r.jsx)("input",{type:"file",name:"preview2",accept:"audio/mp3",onChange:m,required:!0}),(0,r.jsx)("input",{type:"file",name:"preview3",accept:"audio/mp3",onChange:m,required:!0}),(0,r.jsx)("input",{type:"file",name:"qrCode",accept:"image/*",onChange:m,required:!0}),(0,r.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white py-3 rounded",children:o?"Uploading...":"Upload Album"})]})]})]})}var c=t(4002),d=t(7799);function m(){let[e,l]=(0,s.useState)([]),[t,n]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=async()=>{let{data:e,error:l}=await a.O.auth.getUser();!l&&(null==e?void 0:e.user)&&n(e.user)};(async()=>{let{data:e,error:t}=await a.O.from("albums").select("*");!t&&e?l(e):console.error("Error loading albums:",t)})(),e()},[]),(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-blue-50 to-white",children:[(0,r.jsx)(c.Z,{onUploadClick:()=>{}}),(0,r.jsxs)("main",{className:"px-4 sm:px-6 lg:px-12 py-10 grow",children:[(0,r.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-center text-blue-900 mb-12",children:"\uD83C\uDFB5 Explore Albums for Sale"}),(null==t?void 0:t.id)==="592d839a-739f-4043-bea7-6e96f4c8f456"&&(0,r.jsx)("div",{className:"flex justify-center mb-12",children:(0,r.jsx)("div",{className:"bg-white shadow-lg rounded-2xl p-6 w-full max-w-3xl",children:(0,r.jsx)(u,{})})}),(0,r.jsx)("div",{className:"overflow-x-auto hide-scrollbar",children:(0,r.jsx)("div",{className:"flex flex-nowrap gap-6 sm:grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e.length>0?e.map(e=>(0,r.jsx)("div",{className:"flex-shrink-0 sm:flex-shrink sm:contents",children:(0,r.jsx)(o,{album:e})},e.id)):(0,r.jsx)("p",{className:"text-center text-gray-600 col-span-full",children:"No albums uploaded yet."})})})]}),(0,r.jsx)(d.Z,{})]})}},9259:function(e,l,t){"use strict";t.d(l,{Z:function(){return r}});let r=(0,t(7977).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])}},function(e){e.O(0,[51,840,127,971,69,744],function(){return e(e.s=3354)}),_N_E=e.O()}]);